<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>HTML 5 Boilerplate</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <h1>Your Cart</h1>
    <div id="cart-items"></div>
    <p id="cart-total"></p>
    <button id="checkout-btn">Proceed to Checkout</button>

  <script src="js/cart.js" defer></script>
  <script src="js/version.js" defer></script>

  <!-- Firebase and Firestore imports -->
  <script type="module">
  import { db } from './js/firebase.js';
  import { collection, addDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

  // --- Time tracking ---
  const startTime = Date.now();

  // Render the cart from localStorage (from cart.js)
  renderCart();

  // Checkout button click
  document.getElementById('checkout-btn').addEventListener('click', async () => {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const shopVersion = localStorage.getItem('shopVersion') || 'unknown';
    const endTime = Date.now();
    const timeSpent = Math.round((endTime - startTime) / 1000); // seconds

  try {
    await addDoc(collection(db, "orders"), {
      sessionId: localStorage.getItem("sessionId"),   // ✅ REQUIRED
      shopVersion: localStorage.getItem("shopVersion"),
      timestamp: new Date().toISOString(),
      cart: cart,
      timeSpent: timeSpent
    });

      alert('✅ Order submitted successfully!');
      localStorage.removeItem('cart');
      window.location.href = 'thankyou.html'; // optional
    } catch (error) {
      console.error('Error submitting order:', error);
      alert('⚠️ There was an issue saving your order. Please try again.');
    }
  });
  </script>
</body>
</html>
